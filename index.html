<html>
<head>
   <title>Project 1</title>
   <style type="text/css">

   /* On mouse hover, lighten state color */
   path:hover {
      fill-opacity: .7;
   }

   /* Style for Custom Tooltip */
   div.tooltip {
      position: absolute;
      text-align: center;
      width: 60px;
      height: 28px;
      padding: 2px;
      font: 12px sans-serif;
      background: white;
      border: 0px;
      border-radius: 8px;
      pointer-events: none;
   }

   /* Legend Font Style */
   body {
      font: 11px sans-serif;
   }

   /* Legend Position Style */
   .legend {
      position:absolute;
      left:800px;
      top:350px;
   }
</style>
</head>
<body>   </style>
   <svg width = "960" height = "600"></svg>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
   <meta charset="utf-8">
   <script src="https://d3js.org/d3-color.v1.min.js"></script>
   <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
   <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
   <script src="https://d3js.org/d3.v3.min.js"></script>
   <script src="https://d3js.org/topojson.v2.min.js"></script>

</head>

<body>
        <h1>Spatial data: </h1>

    <script = type="text/javascript">
// help from http://bl.ocks.org/michellechandra/0b2ce4923dc9b5809922

var width = 960;
var height = 500;

// D3 Projection
var projection = d3.geo.albersUsa()
                        // translate to center of screen
                       .translate([width/2, height/2])
                        // scale things down so see entire US
                       .scale([1000]);

// Define path generator
// path generator that will convert GeoJSON to SVG paths
var path = d3.geo.path()
                 .projection(projection);


// Define linear scale for output
var color = d3.scale.quantize()
.range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);


var x = d3.scale.linear()
    .domain([1, 4000]);
//    .rangeRound([600, 860]);


//Create SVG element and append map to the SVG
var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

// add the key
var g = svg.append("g")
    .attr("class", "key")
    .attr("transform", "translate(0,40)");

g.selectAll("rect")
  .data(color.range().map(function(d) {
      d = color.invertExtent(d);
      if (d[0] == null) d[0] = x.domain()[0];
      if (d[1] == null) d[1] = x.domain()[1];
      return d;
    }))
  .enter().append("rect")
    .attr("height", 8)
    .attr("x", function(d) { return x(d[0]); })
    .attr("width", function(d) { return x(d[1]) - x(d[0]); })
    .attr("fill", function(d) { return color(d[0]); });

g.append("text")
    .attr("class", "caption")
    .attr("x", x.range()[0])
    .attr("y", -6)
    .attr("fill", "#000")
    .attr("text-anchor", "start")
    .attr("font-weight", "bold")
    .text("# On Zayo");


g.call(d3.svg.axis(x)
    .tickSize(13)
    .tickValues(color.domain()))
  .select(".domain")
    .remove();


// Append Div for tooltip to SVG
var div = d3.select("body")
             .append("div")
             .attr("class", "tooltip")
             .style("opacity", 0);


// convert from state abbreviation to state name
var states_array = {
    "AL": "Alabama",
    "AK": "Alaska",
    "AS": "American Samoa",
    "AZ": "Arizona",
    "AR": "Arkansas",
    "CA": "California",
    "CO": "Colorado",
    "CT": "Connecticut",
    "DE": "Delaware",
    "DC": "District Of Columbia",
    "FM": "Federated States Of Micronesia",
    "FL": "Florida",
    "GA": "Georgia",
    "GU": "Guam",
    "HI": "Hawaii",
    "ID": "Idaho",
    "IL": "Illinois",
    "IN": "Indiana",
    "IA": "Iowa",
    "KS": "Kansas",
    "KY": "Kentucky",
    "LA": "Louisiana",
    "ME": "Maine",
    "MH": "Marshall Islands",
    "MD": "Maryland",
    "MA": "Massachusetts",
    "MI": "Michigan",
    "MN": "Minnesota",
    "MS": "Mississippi",
    "MO": "Missouri",
    "MT": "Montana",
    "NE": "Nebraska",
    "NV": "Nevada",
    "NH": "New Hampshire",
    "NJ": "New Jersey",
    "NM": "New Mexico",
    "NY": "New York",
    "NC": "North Carolina",
    "ND": "North Dakota",
    "MP": "Northern Mariana Islands",
    "OH": "Ohio",
    "OK": "Oklahoma",
    "OR": "Oregon",
    "PW": "Palau",
    "PA": "Pennsylvania",
    "PR": "Puerto Rico",
    "RI": "Rhode Island",
    "SC": "South Carolina",
    "SD": "South Dakota",
    "TN": "Tennessee",
    "TX": "Texas",
    "UT": "Utah",
    "VT": "Vermont",
    "VI": "Virgin Islands",
    "VA": "Virginia",
    "WA": "Washington",
    "WV": "West Virginia",
    "WI": "Wisconsin",
    "WY": "Wyoming"
}
// Load in my  data!


d3.csv("/data/ZayoHackathonData_Sites.csv", function(data) {
       var onZayo = {};
       var notOnZayo = {};
          $.each(data, function (i){
              if (data[i]['On Zayo Network Status']==='On Zayo Network'){
                   if (data[i]['State'] in onZayo){
                      onZayo[data[i]['State']] +=1;
//                      console.log(onZayo[data[i]['State']]);
                   } else {
                      onZayo[data[i]['State']]= 1
                   }
              }
              //console.log(data[i]['State']);
          });;
          color.domain([ d3.min(onZayo, function(d) {return d.value;}),
                         d3.max(onZayo, function(d) {return d.value;})
          ]);
    // Load GeoJSON data and merge with states data
    console.log(Object.keys(onZayo).length);
    d3.json('data/usa_data.json', function(json) {
    // Loop through each state data value in the onZayo object
       for (var i = 0; i < Object.keys(onZayo).length; i++) {
         keys = Object.keys(onZayo);
         console.log(keys);
         // Grab State Name
         var dataState = states_array[keys[i]];
         console.log(dataState);
         // Grab data value
         var dataValue = onZayo[keys[i]];
         console.log(dataValue);
         console.log(json.features[j]);
         // Find the corresponding state inside the GeoJSON
         for (var j = 0; j < json.features.length; j++)  {
             var jsonState = json.features[j].properties.name;
             if (dataState == jsonState) {
                // Copy the data value into the JSON
                 json.features[j].properties.onZayo = dataValue;
                 console.log (json.features[j].properties.onZayo);
                // Stop looking through the JSON
                break;
             } else {
                json.features[j].properties.onZayo = 0;
             }
      }
   }
   // Bind the data to the SVG and create one path per GeoJSON feature
   svg.selectAll("path")
      .data(json.features)
      .enter()
      .append("path")
      .attr("d", path)
      .style("stroke", "#fff")
      .style("stroke-width", "1")
      .style("fill", function(d) {

            // Get data value
            var value = d.properties.onZayo;

            if (value) {
            //If value exists…
            return color(value);
            } else {
            //If value is undefined…
            return "rgb(213,222,217)";
            }
         })
        .on("mouseover", function(d) {
             div.transition()
                  .duration(200)
                  .style("opacity", .9);
                 div.text(d.properties.onZayo)
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");
	})   ;

// Modified Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852

var legend = d3.select("body").append("svg")
      			.attr("class", "legend")
     			.attr("width", 140)
    			.attr("height", 200)
   				.selectAll("g")
   				.data(color.domain().slice().reverse())
   				.enter()
   				.append("g")
     			.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  	legend.append("rect")
   		  .attr("width", 18)
   		  .attr("height", 18)
   		  .style("fill", color);

  	legend.append("text")
  		  .data('')
      	  .attr("x", 24)
      	  .attr("y", 9)
      	  .attr("dy", ".35em")
      	  .text(function(d) { return d; });
	});


});

</script>
</body>
</html>
